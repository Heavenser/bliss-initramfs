#!/usr/bin/env python

"""
Copyright (C) 2012-2014 Jonathan Vasquez <fearedbliss@funtoo.org>

This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
"""

import sys
import os

from subprocess import call

from pkg.libs.variables import Variables
from pkg.libs.core import Core
from pkg.libs.copy import Copy
from pkg.libs.toolkit import Toolkit

tools = Toolkit()
var = Variables()

class Creator(object):
	def __init__(self):
		self.core = Core()
		self.copy = Copy(self.core)

	def main(self):
		"""
		Let the games begin!
		"""

		tools.welcome(self.core)

		call(["clear"])

		self.core.print_header()
		self.core.print_menu()
		
		if self.core.addon.modules:
			self.core.do_kernel()

		self.core.get_arch()
		tools.print_start()
		tools.clean()
		self.core.check_prelim_binaries()
		self.core.create_baselayout()
		self.copy.check_binaries()
		self.copy.install()
		self.copy.copy_modules()
		self.core.create_links()
		self.copy.copy_deps()
		self.core.last_steps()
		self.core.create()
		tools.clean_exit(self.core.get_initrd())

if __name__ == '__main__':
	init = Creator()
	init.main()
