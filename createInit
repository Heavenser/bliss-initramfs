#!/bin/bash

# Copyright (C) 2012 Jonathan Vasquez
#
# Distributed under the MIT license which can be found in the LICENSE file.

# Description
# ------------
# This will be the entry point of the application.
# It will display a menu, and depending on the options chosen,
# It will ask for necessary information.
# Once the information is gathered, it will pass that info to
# the appropriate hook in which the initramfs will be created.

# Source functions
. resources/variables.sh
. resources/functions_generic.sh

#######################################################################
# The main entry point starts here
#######################################################################
clear

print_header

print_menu

get_arch

# Check to see if modules directory exists.. only needed for ZFS
if [ ${INIT_TYPE} = "ZFS" ]; then
	check_mods_dir
fi

clean

print_start

create_dirs

check_binaries && check_modules

copy_binaries && copy_modules

# If it's a ZFS initrd, compress the copied modules and generate modules.dep
if [ ${INIT_TYPE} = "ZFS" ]; then
	pack_modules && modules_dep
fi

get_deps

copy_deps

create_symlinks

config_init

create_initrd

clean_all
